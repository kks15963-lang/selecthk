<!DOCTYPE html>
<html lang="ko">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>Purchase Manager 2.0</title>
    <meta http-equiv="Cache-Control" content="no-cache, no-store, must-revalidate">

    <!-- Fonts -->
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700;800&display=swap" rel="stylesheet">

    <!-- CSS -->
    <link rel="stylesheet" href="styles.v2.css?v=Refactor14">

    <!-- Libraries -->
    <script src="html2canvas.min.js" defer></script>

    <!-- Main App -->
    <!-- Main App Split -->
    <script src="js/config.js" defer></script>
    <script src="js/state.js" defer></script>
    <script src="js/dom.js" defer></script>
    <script src="js/utils.js" defer></script>
    <script src="js/api.js" defer></script>
    <script src="js/components.js" defer></script>
    <script src="js/render.js" defer></script>
    <script src="js/actions.js" defer></script>
    <script src="js/main.js" defer></script>
</head>

<body>

    <!-- Header -->
    <header class="header">
        <div class="app-title">Purchase Manager</div>
    </header>

    <!-- Main Content Area -->
    <main id="main-content">

        <!-- 1. DASHBOARD -->
        <section id="view-dashboard" class="section active">
            <!-- Hero Metrics -->
            <div class="dashboard-grid">
                <div class="stat-card" onclick="toggleCurrencyMode()">
                    <div class="stat-label">
                        <span data-i18n="stat_profit">예상 수익</span>
                        <span id="label-curr-mode" class="badge"
                            style="background:rgba(0,0,0,0.05); margin-left:5px;">KRW</span>
                    </div>
                    <div class="stat-value" id="stat-profit">0</div>
                </div>
                <div class="stat-card">
                    <div class="stat-label" data-i18n="stat_pending_settle">정산 필요</div>
                    <div class="stat-value" id="stat-pending-settle">0</div>
                </div>
                <div class="stat-card">
                    <div class="stat-label" data-i18n="stat_revenue">매출 (Sales)</div>
                    <div class="stat-value" id="stat-revenue">0</div>
                    <div class="stat-sub">HKD</div>
                </div>
                <div class="stat-card">
                    <div class="stat-label" data-i18n="stat_cost">매입 지출 (Cost)</div>
                    <div class="stat-value" id="stat-cost">0</div>
                    <div class="stat-sub">KRW</div>
                </div>
            </div>

            <!-- Date Filter -->
            <div class="dashboard-filter" style="margin-top:20px;">
                <div style="display:flex; gap:10px; margin-bottom:10px;">
                    <input type="text" id="dash-date-start" class="form-input" style="flex:1;" placeholder="YYYY-MM-DD"
                        data-i18n-ph="fmt_date" onfocus="(this.type='date')" onblur="(this.type='text')">
                    <span style="align-self:center; color:#94a3b8;">~</span>
                    <input type="text" id="dash-date-end" class="form-input" style="flex:1;" placeholder="YYYY-MM-DD"
                        data-i18n-ph="fmt_date" onfocus="(this.type='date')" onblur="(this.type='text')">
                </div>
                <div style="display:flex; justify-content:space-between;">
                    <div class="preset-group">
                        <button id="btn-dash-today" class="btn-xs" data-i18n="lbl_today">오늘</button>
                        <button id="btn-dash-week" class="btn-xs" data-i18n="lbl_week">이번주</button>
                        <button id="btn-dash-month" class="btn-xs" data-i18n="lbl_month">이번달</button>
                    </div>
                    <button id="btn-dash-reset" class="btn-xs" data-i18n="lbl_reset">전체</button>
                </div>
            </div>

            <!-- Pipeline -->
            <div class="pipeline-container">
                <div class="pipeline-step step-pending" onclick="navigate('view-purchase')">
                    <span id="badge-pending" class="step-count">0</span>
                    <span class="step-label" data-i18n="nav_purchase">매입필요</span>
                </div>
                <div style="color:#cbd5e1;">&gt;</div>
                <div class="pipeline-step step-ordered" onclick="navigate('view-korea')">
                    <span id="badge-ordered" class="step-count">0</span>
                    <span class="step-label" data-i18n="nav_korea">발송대기</span>
                </div>
                <div style="color:#cbd5e1;">&gt;</div>
                <div class="pipeline-step step-shipped" onclick="navigate('view-hongkong')">
                    <span id="badge-shipped-kr" class="step-count">0</span>
                    <span class="step-label" data-i18n="nav_hk">배송대기</span>
                </div>
                <div style="color:#cbd5e1;">&gt;</div>
                <div class="pipeline-step step-completed" onclick="navigate('view-finance')">
                    <span id="badge-completed" class="step-count">0</span>
                    <span class="step-label" data-i18n="nav_finance">정산대기</span>
                </div>
            </div>

            <div style="height:30px;"></div>
            <!-- Profit Breakdown -->
            <div id="dashboard-profit-list" class="card-list"></div>
        </section>

        <!-- 2. ORDER LIST -->
        <section id="view-list" class="section">
            <h2 class="section-title" data-i18n="sec_order_list">주문 내역 관리</h2>

            <div id="filter-container" class="filter-container">
                <div class="filter-row">
                    <input type="search" id="filter-customer" class="form-input" placeholder="고객명 (Customer)"
                        data-i18n-ph="ph_customer" style="flex:1;">
                    <input type="search" id="filter-product" class="form-input" placeholder="상품명 (Product)"
                        data-i18n-ph="ph_product" style="flex:1;">
                </div>
                <div class="filter-row">
                    <select id="filter-status" class="form-input" style="flex:1;">
                        <option value="All" data-i18n="lbl_status_all">전체 상태 (All Status)</option>
                        <option value="Pending" data-i18n="status_pending">매입필요</option>
                        <option value="Ordered" data-i18n="status_ordered">발송대기</option>
                        <option value="Shipped_to_HK" data-i18n="status_shipped_to_hk">배송대기</option>
                        <option value="Completed" data-i18n="status_completed">정산대기</option>
                        <option value="Settled" data-i18n="status_settled">정산완료</option>
                        <option value="Cancelled" data-i18n="status_cancelled">주문취소</option>
                    </select>
                </div>
                <div class="filter-row">
                    <input type="text" id="filter-date-start" class="form-input" style="flex:1;"
                        placeholder="YYYY-MM-DD" data-i18n-ph="fmt_date" onfocus="(this.type='date')"
                        onblur="(this.type='text')">
                    <span style="align-self:center; color:#94a3b8;">~</span>
                    <input type="text" id="filter-date-end" class="form-input" style="flex:1;" placeholder="YYYY-MM-DD"
                        data-i18n-ph="fmt_date" onfocus="(this.type='date')" onblur="(this.type='text')">
                </div>
                <div class="filter-actions">
                    <div class="preset-group">
                        <button id="btn-period-today" class="btn-xs" data-i18n="lbl_today">오늘</button>
                        <button id="btn-period-week" class="btn-xs" data-i18n="lbl_week">1주일</button>
                        <button id="btn-period-month" class="btn-xs" data-i18n="lbl_month">1개월</button>
                    </div>
                    <button id="btn-filter-reset" class="btn-xs"
                        style="color:var(--danger); border-color:var(--danger);" data-i18n="lbl_reset">
                        🔄 초기화
                    </button>
                </div>
            </div>

            <div id="order-list-container" class="card-list"></div>

            <!-- Floating Action Button -->
            <div id="fab-add" class="fab">
                <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none"
                    stroke="currentColor" stroke-linecap="round" stroke-linejoin="round">
                    <line x1="12" y1="5" x2="12" y2="19"></line>
                    <line x1="5" y1="12" x2="19" y2="12"></line>
                </svg>
            </div>
        </section>

        <!-- 3. PURCHASE -->
        <section id="view-purchase" class="section">
            <h2 class="section-title" data-i18n="sec_purchase">매입 대기 목록</h2>
            <div id="purchase-list-container" class="card-list"></div>
            <div id="action-bar-purchase" class="fixed-bottom-action hidden">
                <button id="btn-bulk-purchase" class="btn-primary-large">선택한 항목 매입 확정하기</button>
            </div>
        </section>

        <!-- 4. KOREA WAREHOUSE -->
        <section id="view-korea" class="section">
            <h2 class="section-title" data-i18n="sec_korea">배대지 발송 대기</h2>
            <div id="korea-list-container" class="card-list"></div>
            <div id="action-bar-korea" class="fixed-bottom-action hidden">
                <button id="btn-bulk-korea" class="btn-primary-large">선택한 항목 홍콩으로 발송하기</button>
            </div>
        </section>

        <!-- 5. HONGKONG DELIVERY -->
        <section id="view-hongkong" class="section">
            <h2 class="section-title" data-i18n="sec_hongkong">고객 배송 대기</h2>
            <div class="form-group">
                <input type="search" id="inp-search-hk" class="form-input" placeholder="Search..."
                    data-i18n="ph_search">
            </div>
            <div id="hongkong-list-container" class="card-list"></div>
            <div id="action-bar-hongkong" class="fixed-bottom-action hidden">
                <button id="btn-bulk-hk" class="btn-primary-large">선택한 항목 배송 완료 처리 (Ship)</button>
            </div>
        </section>

        <!-- 6. FINANCE -->
        <section id="view-finance" class="section">
            <h2 class="section-title" data-i18n="settlement_title">정산 대기 목록</h2>
            <div id="finance-list-container" class="card-list"></div>
            <div id="action-bar-finance" class="fixed-bottom-action hidden">
                <button id="btn-bulk-settle" class="btn-primary-large">선택한 항목 수익 정산하기 (Settle)</button>
            </div>
        </section>

        <!-- 7. SETTINGS -->
        <section id="view-settings" class="section">
            <h2 class="section-title" style="margin-bottom:30px;" data-i18n="set_title">설정 (Settings)</h2>

            <div class="settings-group">
                <label data-i18n="set_lang">언어 설정 (Language)</label>
                <div class="row">
                    <button id="btn-lang-ko" class="btn-option active">한국어</button>
                    <button id="btn-lang-cn" class="btn-option">中文</button>
                </div>
            </div>

            <div class="settings-group">
                <label data-i18n="set_curr">통화 모드 (Currency View)</label>
                <div class="row">
                    <button id="btn-curr-krw" class="btn-option active">KRW (원)</button>
                    <button id="btn-curr-hkd" class="btn-option">HKD (달러)</button>
                </div>
            </div>

            <div class="settings-group">
                <label data-i18n="set_rate">환율 설정 (Exchange Rate)</label>
                <div style="display:flex; gap:10px;">
                    <input type="number" id="inp-exchange-rate" class="form-input" style="flex:1;">
                    <button id="btn-fetch-rate" class="btn-secondary-large"
                        style="width:auto; padding:0 20px;">↺</button>
                </div>
                <div style="font-size:11px; color:#94a3b8; margin-top:5px;" data-i18n="desc_rate">기본값: 실시간 환율 (수동 변경 가능)
                </div>
            </div>

            <div class="settings-group">
                <label data-i18n="set_sync">데이터 동기화</label>
                <button id="btn-refresh-manual" class="btn-secondary-large" data-i18n="btn_refresh">서버 데이터 새로고침
                    (Refresh)</button>
            </div>
        </section>

        <!-- 8. ORDER FORM -->
        <section id="view-form" class="section">
            <div class="section-header"
                style="display:flex; justify-content:space-between; align-items:center; margin-bottom:20px;">
                <h2 class="section-title" data-i18n="sec_form" style="margin:0;">새 주문 작성</h2>
            </div>

            <input type="hidden" id="inp-order-id">
            <div class="form-group">
                <label class="form-label" data-i18n="lbl_date">날짜</label>
                <input type="text" id="inp-date" class="form-input" placeholder="YYYY-MM-DD" data-i18n-ph="fmt_date"
                    onfocus="(this.type='date')" onblur="(this.type='text')">
            </div>
            <div class="form-group">
                <label class="form-label"><span data-i18n="lbl_customer">고객명</span> <span
                        style="color:var(--danger)">*</span></label>
                <input type="text" id="inp-customer" class="form-input" list="dl-customers" placeholder="Name"
                    data-i18n-ph="ph_customer">
                <datalist id="dl-customers"></datalist>
            </div>
            <div class="form-group">
                <label class="form-label" data-i18n="lbl_address">주소</label>
                <input type="text" id="inp-address" class="form-input" placeholder="Address">
            </div>

            <div id="product-rows-container"></div>

            <div class="form-group" style="margin-top:20px;">
                <label class="form-label" data-i18n="lbl_remarks">비고</label>
                <textarea id="inp-remarks" class="form-textarea" rows="2"></textarea>
            </div>

            <div style="height:120px;"></div> <!-- Spacer -->

            <div class="fixed-bottom-action">
                <div class="sub-actions">
                    <button id="btn-close-form" class="btn-link" data-i18n="btn_close">작성 취소하고 돌아가기</button>
                </div>
                <button id="btn-save-order" class="btn-primary-large" data-i18n="btn_save">주문 정보 저장 완료</button>
            </div>
        </section>

    </main>

    <!-- MODALS -->

    <!-- Receipt Modal -->
    <div id="receipt-modal" class="modal hidden" style="z-index: 10000;">
        <div class="modal-content-bottom"
            style="background:transparent; box-shadow:none; padding:0; width:90%; max-width:400px; align-self:center; margin-bottom:auto; margin-top:auto;">
            <div id="receipt-paper" class="receipt-paper">
                <div style="text-align:center; font-weight:800; font-size:20px; margin-bottom:5px; letter-spacing:1px;">
                    RECEIPT</div>
                <div style="text-align:center; font-size:14px; color:#64748b; margin-bottom:20px;">select.korea.hk</div>

                <div
                    style="display:flex; justify-content:space-between; font-size:12px; color:#64748b; margin-bottom:5px;">
                    <span id="rcpt-date"></span>
                    <span id="rcpt-id"></span>
                </div>
                <div style="border-bottom:2px dashed #e2e8f0; margin:10px 0;"></div>
                <div id="rcpt-items" style="margin:20px 0;"></div>
                <div style="border-bottom:2px dashed #e2e8f0; margin:10px 0;"></div>

                <div
                    style="display:flex; justify-content:space-between; font-weight:700; font-size:18px; margin-top:20px;">
                    <span>TOTAL</span>
                    <span id="rcpt-total">HKD 0</span>
                </div>
                <div style="text-align:center; margin-top:30px; font-size:11px; color:#94a3b8;">Thank you for your
                    business!</div>
            </div>
            <div style="text-align:center; margin-top:20px;">
                <button id="btn-close-receipt" class="btn-circle-action"
                    style="background:white; color:black; width:40px; height:40px; margin:0 auto;">✕</button>
            </div>
        </div>
    </div>

    <!-- Purchase Modal -->
    <div id="purchase-modal" class="modal hidden">
        <div class="modal-content-bottom">
            <h3 data-i18n="lbl_krw">매입가 입력</h3>
            <p id="purchase-item-name" class="modal-desc"></p>
            <input type="number" id="modal-inp-krw" class="form-input-large" placeholder="KRW 0" data-i18n="ph_cost">
            <button id="btn-save-cost" class="btn-primary-large" style="margin-top:20px;" data-i18n="btn_save_cost">매입가
                저장하고 완료하기</button>
        </div>
    </div>

    <!-- Korea Modal -->
    <div id="korea-modal" class="modal hidden">
        <div class="modal-content-bottom">
            <h3 data-i18n="lbl_ship_fee">배대지 비용 입력</h3>
            <p id="korea-modal-desc" class="modal-desc"></p>
            <input type="number" id="inp-ship-total" class="form-input-large" placeholder="Total Ship Fee (HKD)">
            <button id="btn-save-korea" class="btn-primary-large" style="margin-top:20px;" data-i18n="btn_ship_save">배송비
                저장하고 발송 처리하기</button>
        </div>
    </div>

    <!-- HK Modal -->
    <div id="hk-modal" class="modal hidden">
        <div class="modal-content-bottom">
            <h3 data-i18n="lbl_hk_ship">배송 완료 처리</h3>
            <div id="hk-customer-info" style="border-bottom:1px solid #eee; padding-bottom:10px;"></div>
            <div id="hk-item-list"
                style="max-height:150px; overflow-y:auto; background:#f8fafc; padding:10px; border-radius:8px;"></div>

            <div id="hk-input-container" class="hidden">
                <label class="form-label" data-i18n="lbl_address">배송 주소</label>
                <input type="text" id="inp-hk-address" class="form-input" placeholder="Address">

                <div class="row" style="margin-top:10px;">
                    <select id="sel-delivery-method" class="form-input">
                        <option value="SF Express">SF Express</option>
                        <option value="Local Post">Local Post</option>
                        <option value="Meet-up">Meet-up</option>
                        <option value="Pickup">Pickup</option>
                    </select>
                </div>

                <input type="text" id="inp-tracking" class="form-input" placeholder="Tracking No."
                    style="margin-top:10px;">
                <input type="number" id="inp-local-fee" class="form-input" placeholder="Local Fee (Total HKD)"
                    style="margin-top:10px;">
            </div>

            <button id="btn-hk-next" class="btn-primary-large" style="margin-top:20px;" data-i18n="btn_hk_next">배송 정보
                입력하기</button>
            <button id="btn-save-hk" class="btn-primary-large hidden" style="margin-top:20px;"
                data-i18n="btn_hk_save">배송 정보 저장하기</button>
        </div>
    </div>

    <!-- Settlement Modal -->
    <div id="settlement-modal" class="modal hidden">
        <div class="modal-content-bottom">
            <h3 data-i18n="lbl_settle">수익 정산</h3>
            <p id="settlement-desc" class="modal-desc"></p>
            <input type="number" id="inp-settle-total" class="form-input-large" placeholder="Total Available KRW"
                data-i18n-ph="ph_cost">
            <button id="btn-save-settle" class="btn-primary-large" style="margin-top:20px;"
                data-i18n="btn_settle_save">금액 확인하고 정산 처리하기</button>
        </div>
    </div>

    <!-- Sheet: Order Management -->
    <div id="order-management-sheet" class="management-sheet hidden">
        <div style="position:absolute; top:15px; right:20px;">
            <button id="btn-mng-delete" class="action-btn danger" data-i18n="btn_mng_del"
                style="padding:0; border:none; font-size:12px; width:auto; justify-content:flex-end;">
                🗑️ 기록 삭제
            </button>
        </div>
        <div style="height:30px;"></div>
        <div class="sub-actions"
            style="display:flex; justify-content:space-between; margin-bottom:15px; flex-wrap:wrap; gap:10px;">
            <button id="btn-mng-delivery" class="btn-link hidden" data-i18n="btn_mng_ship"
                style="width:100%; border-color:var(--primary); color:var(--primary);">🚚 배송 정보 입력/수정</button>
            <button id="btn-mng-receipt" class="btn-link" style="flex:1;" data-i18n="btn_mng_rcpt">🧾 영수증 확인</button>
            <button id="btn-mng-refund" class="btn-link" data-i18n="btn_mng_refund">↩️ 환불 및 취소</button>
        </div>
        <button id="btn-mng-edit" class="btn-primary-large" data-i18n="btn_mng_edit">주문 정보 수정하고 업데이트하기</button>
    </div>

    <!-- Sheet: Product Action -->
    <div id="product-action-sheet" class="action-sheet-overlay">
        <div class="action-sheet">
            <h3 style="margin:0 0 15px 0;" data-i18n="title_prod_mng">상품 관리</h3>
            <button class="action-btn" id="btn-action-add" data-i18n="btn_act_add">➕ 아래에 새 상품 추가</button>
            <button class="action-btn" id="btn-action-copy" data-i18n="btn_act_copy">📋 이 상품 복사하기</button>
            <button class="action-btn danger" id="btn-action-delete" data-i18n="btn_act_del">🗑️ 삭제하기</button>
            <button class="action-btn" id="btn-action-cancel" data-i18n="btn_act_cancel"
                style="justify-content:center; color:#64748b;">취소</button>
        </div>
    </div>

    <!-- Auth Overlay -->
    <div id="auth-overlay"
        style="position:fixed; top:0; left:0; width:100%; height:100%; background:white; z-index:9999; display:flex; flex-direction:column; align-items:center; justify-content:center;">
        <h2 style="color:var(--primary); margin-bottom:20px; font-weight:800;">Purchase Manager</h2>
        <input type="password" id="auth-code"
            style="padding:15px; border:1px solid #ccc; border-radius:12px; font-size:24px; text-align:center; width:200px; margin-bottom:20px;"
            placeholder="PIN">
        <button id="btn-auth-confirm" class="btn-primary-large" style="width:200px;"
            data-i18n="btn_auth_enter">접속하기</button>
    </div>

    <!-- Components -->
    <div id="toast-container" class="toast-container"></div>
    <div id="loading-overlay" class="hidden">
        <img src="loading.png" class="loading-spinner" alt="Loading...">
    </div>

    <!-- Navigation -->
    <nav class="bottom-nav">
        <button class="nav-item active" data-target="view-dashboard"><span>📊</span><span
                data-i18n="nav_dash">현황</span></button>
        <button class="nav-item" data-target="view-list"><span>📋</span><span data-i18n="nav_list">주문</span></button>
        <button class="nav-item" data-target="view-purchase"><span>🛒</span><span
                data-i18n="nav_purchase">매입</span></button>
        <button class="nav-item" data-target="view-korea"><span>📦</span><span data-i18n="nav_korea">배대지</span></button>
        <button class="nav-item" data-target="view-hongkong"><span>🚚</span><span data-i18n="nav_hk">배송</span></button>
        <button class="nav-item" data-target="view-finance"><span>💰</span><span
                data-i18n="nav_finance">정산</span></button>
        <button class="nav-item" data-target="view-settings"><span>⚙️</span><span
                data-i18n="nav_settings">설정</span></button>
    </nav>

    <!-- Datalists -->
    <datalist id="dl-customers"></datalist>
    <datalist id="list-products"></datalist>
</body>

</html>